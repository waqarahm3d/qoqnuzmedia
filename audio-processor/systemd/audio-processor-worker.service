[Unit]
Description=Audio Processor Celery Worker
After=network.target redis-server.service postgresql.service

[Service]
Type=forking
User=audioprocessor
Group=audioprocessor
WorkingDirectory=/home/audioprocessor/audio-processor
Environment="PATH=/home/audioprocessor/audio-processor/venv/bin"
ExecStart=/home/audioprocessor/audio-processor/venv/bin/celery -A app.celery_app worker --loglevel=info --concurrency=2 --logfile=/home/audioprocessor/audio-processor/logs/celery-worker.log --pidfile=/home/audioprocessor/audio-processor/temp/celery-worker.pid
ExecStop=/home/audioprocessor/audio-processor/venv/bin/celery -A app.celery_app control shutdown
Restart=always
RestartSec=10

# Security settings
NoNewPrivileges=true
PrivateTmp=true

# Resource limits
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
